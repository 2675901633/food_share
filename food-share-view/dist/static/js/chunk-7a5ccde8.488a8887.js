(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7a5ccde8"],{1956:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"default-food-image"},[a("svg",{staticClass:"food-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"}},[a("path",{attrs:{d:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,17H13V14H16V12H13V9H11V12H8V14H11V17Z"}})]),a("span",[t._v("暂无图片")])])},i=[],l={name:"DefaultFoodImage"},r=l,o=(a("7ae7"),a("2877")),n=Object(o["a"])(r,s,i,!1,null,"153742af",null);e["a"]=n.exports},"35ed":function(t,e,a){"use strict";a.d(e,"g",(function(){return i})),a.d(e,"f",(function(){return l})),a.d(e,"d",(function(){return r})),a.d(e,"j",(function(){return o})),a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return c})),a.d(e,"l",(function(){return d})),a.d(e,"c",(function(){return u})),a.d(e,"i",(function(){return h})),a.d(e,"k",(function(){return m})),a.d(e,"e",(function(){return f})),a.d(e,"h",(function(){return g}));var s=a("b775");function i(t){return Object(s["a"])({url:"/flashSale/list",method:"post",data:t})}function l(t){return Object(s["a"])({url:"/flashSale/detail/"+t,method:"get"})}function r(t){return Object(s["a"])({url:"/flashSale/doFlashSale/"+t,method:"post"})}function o(){return Object(s["a"])({url:"/flashSale/myOrders",method:"get"})}function n(t){return Object(s["a"])({url:"/flashSale/cancelOrder/"+t,method:"post"})}function c(t){return Object(s["a"])({url:"/flashSale/admin/create",method:"post",data:t})}function d(t){return Object(s["a"])({url:"/flashSale/admin/update",method:"post",data:t})}function u(t){return Object(s["a"])({url:"/flashSale/admin/delete/"+t,method:"post"})}function h(){return Object(s["a"])({url:"/flashSale/admin/preload",method:"post"})}function m(){return Object(s["a"])({url:"/flashSale/admin/refresh",method:"post"})}function f(t){return Object(s["a"])({url:"/flashSale/orders",method:"post",data:t})}function g(t){return Object(s["a"])({url:"/flashSale/payOrder/"+t,method:"post"})}},"537f":function(t,e,a){"use strict";a("5518")},5518:function(t,e,a){},"5c36":function(t,e,a){},"64ab":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"flash-sale-detail"},[a("div",{staticClass:"page-header"},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/flashSale"}}},[t._v("限时秒杀")]),a("el-breadcrumb-item",[t._v("秒杀详情")])],1)],1),t.flashSaleItem?a("div",{staticClass:"detail-content"},[a("div",{staticClass:"detail-left"},[a("div",{staticClass:"product-image"},[t.flashSaleItem.image?a("img",{attrs:{src:t.flashSaleItem.image,alt:"商品图片"}}):a("default-food-image"),a("div",{staticClass:"status-badge",class:t.getStatusClass(t.flashSaleItem.status)},[t._v(" "+t._s(t.getStatusText(t.flashSaleItem.status))+" ")])],1)]),a("div",{staticClass:"detail-right"},[a("h1",{staticClass:"product-name"},[t._v(t._s(t.flashSaleItem.name))]),a("div",{staticClass:"product-price"},[a("div",{staticClass:"price-container"},[a("div",{staticClass:"price-label"},[t._v("秒杀价")]),a("div",{staticClass:"flash-price"},[t._v("¥"+t._s(t.flashSaleItem.flashPrice))]),a("div",{staticClass:"original-price"},[t._v("原价: ¥"+t._s(t.flashSaleItem.originalPrice))])]),a("div",{staticClass:"discount"},[t._v(" "+t._s(t.getDiscountRate(t.flashSaleItem.flashPrice,t.flashSaleItem.originalPrice))+"折 ")])]),a("div",{staticClass:"countdown-box",class:t.getStatusClass(t.flashSaleItem.status)},[a("div",{staticClass:"countdown-label"},[t._v(t._s(t.getStatusText(t.flashSaleItem.status)))]),2!==t.flashSaleItem.status?a("div",{staticClass:"countdown-timer"},[a("countdown",{attrs:{time:1e3*t.flashSaleItem.remainSeconds,format:1===t.flashSaleItem.status?"结束倒计时: hh时mm分ss秒":"开始倒计时: hh时mm分ss秒"},on:{finish:t.loadData}})],1):a("div",{staticClass:"countdown-timer"},[t._v(" 活动已结束 ")])]),a("div",{staticClass:"product-stock"},[a("div",{staticClass:"stock-info"},[a("span",{staticClass:"stock-label"},[t._v("库存:")]),a("span",{staticClass:"stock-value"},[t._v(t._s(t.flashSaleItem.stock))])]),a("div",{staticClass:"stock-info"},[a("span",{staticClass:"stock-label"},[t._v("已售:")]),a("span",{staticClass:"stock-value"},[t._v(t._s(t.flashSaleItem.soldCount||0))])]),a("el-progress",{attrs:{percentage:t.getProgressPercentage(t.flashSaleItem),color:t.getProgressColor(t.flashSaleItem),format:t.percentFormat,"stroke-width":20}})],1),a("div",{staticClass:"product-actions"},[a("el-button",{attrs:{type:"danger",size:"large",round:"",disabled:!t.canBuy(t.flashSaleItem),loading:t.buyLoading},on:{click:t.handleFlashSale}},[t._v(" "+t._s(t.getBuyButtonText(t.flashSaleItem))+" ")]),a("el-button",{attrs:{type:"info",size:"large",plain:"",round:""},on:{click:function(e){return t.$router.push("/myOrders")}}},[t._v(" 我的订单 ")])],1),a("div",{staticClass:"sale-time"},[a("div",{staticClass:"time-item"},[a("span",{staticClass:"time-label"},[t._v("开始时间:")]),a("span",{staticClass:"time-value"},[t._v(t._s(t.formatDateTime(t.flashSaleItem.startTime)))])]),a("div",{staticClass:"time-item"},[a("span",{staticClass:"time-label"},[t._v("结束时间:")]),a("span",{staticClass:"time-value"},[t._v(t._s(t.formatDateTime(t.flashSaleItem.endTime)))])])])])]):t._e(),a("div",{staticClass:"product-details"},[a("div",{staticClass:"section-title"},[t._v("商品详情")]),a("div",{staticClass:"product-description",domProps:{innerHTML:t._s(t.flashSaleItem&&t.flashSaleItem.description?t.flashSaleItem.description:"暂无详情")}})]),a("el-dialog",{attrs:{title:t.dialogTitle,visible:t.dialogVisible,width:"30%","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"dialog-content"},[a("div",{staticClass:"dialog-icon",class:t.dialogSuccess?"success":"error"},[a("i",{class:t.dialogSuccess?"el-icon-success":"el-icon-error"})]),a("div",{staticClass:"dialog-message"},[t._v(t._s(t.dialogMessage))])]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.handleDialogConfirm}},[t._v(t._s(t.dialogButtonText))])],1)])],1)},i=[],l=a("35ed"),r=a("1956"),o={name:"FlashSaleDetail",data(){return{loading:!1,buyLoading:!1,flashSaleItem:null,dialogVisible:!1,dialogTitle:"",dialogMessage:"",dialogSuccess:!1,dialogButtonText:"确定",saleOrder:null,timer:null}},created(){this.loadData(),this.timer=setInterval(this.loadData,3e4)},beforeDestroy(){this.timer&&clearInterval(this.timer)},methods:{loadData(){this.loading=!0;const t=this.$route.query.id;if(!t)return this.$message.error("商品ID不存在"),void this.$router.push("/flashSale");Object(l["f"])(t).then(t=>{t.data&&200===t.data.code?this.flashSaleItem=t.data.data:this.$message.error(t.data.msg||"获取秒杀商品详情失败")}).catch(t=>{console.error(t),this.$message.error("获取秒杀商品详情失败")}).finally(()=>{this.loading=!1})},handleFlashSale(){this.flashSaleItem&&(this.buyLoading=!0,Object(l["d"])(this.flashSaleItem.id).then(t=>{t.data&&200===t.data.code?(this.dialogSuccess=!0,this.dialogTitle="秒杀成功",this.dialogMessage="恭喜您，秒杀成功！",this.dialogButtonText="查看订单",this.saleOrder=t.data.data):(this.dialogSuccess=!1,this.dialogTitle="秒杀失败",this.dialogMessage=t.data.msg||"秒杀失败，请稍后再试",this.dialogButtonText="确定",this.saleOrder=null),this.dialogVisible=!0}).catch(t=>{console.error(t),this.dialogSuccess=!1,this.dialogTitle="秒杀失败",this.dialogMessage="系统繁忙，请稍后再试",this.dialogButtonText="确定",this.saleOrder=null,this.dialogVisible=!0}).finally(()=>{this.buyLoading=!1,this.loadData()}))},handleDialogConfirm(){this.dialogVisible=!1,this.dialogSuccess&&this.saleOrder&&this.$router.push("/myOrders")},getStatusText(t){return 0===t?"未开始":1===t?"秒杀进行中":2===t?"已结束":"未知状态"},getStatusClass(t){return 0===t?"upcoming":1===t?"ongoing":2===t?"ended":""},getBuyButtonText(t){return t?0===t.status?"即将开始":1===t.status?!1===t.canBuy?"已参与":"立即秒杀":2===t.status?"已结束":"立即秒杀":"立即秒杀"},canBuy(t){return!!t&&(1===t.status&&t.stock>0&&!1!==t.canBuy)},getProgressPercentage(t){if(!t||!t.stock||!t.soldCount)return 0;const e=t.stock+t.soldCount;return Math.floor(t.soldCount/e*100)},percentFormat(t){return t+"%已售"},getProgressColor(t){const e=this.getProgressPercentage(t);return e<50?"#67c23a":e<80?"#e6a23c":"#f56c6c"},getDiscountRate(t,e){if(!t||!e||e<=0)return"10";const a=t/e*10;return a.toFixed(1)},formatDateTime(t){if(!t)return"";const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}},components:{DefaultFoodImage:r["a"],countdown:{props:{time:{type:Number,default:0},format:{type:String,default:"mm:ss"}},data(){return{displayTime:"00:00",remainingTime:this.time,timer:null}},mounted(){this.startCountdown()},beforeDestroy(){this.timer&&clearInterval(this.timer)},methods:{startCountdown(){this.remainingTime=this.time;const t=()=>{if(this.remainingTime<=0)return clearInterval(this.timer),void this.$emit("finish");const t=Math.floor(this.remainingTime/1e3%60),e=Math.floor(this.remainingTime/1e3/60%60),a=Math.floor(this.remainingTime/1e3/60/60%24),s=Math.floor(this.remainingTime/1e3/60/60/24);let i=this.format;i=i.replace("dd",s.toString().padStart(2,"0")),i=i.replace("hh",a.toString().padStart(2,"0")),i=i.replace("mm",e.toString().padStart(2,"0")),i=i.replace("ss",t.toString().padStart(2,"0")),this.displayTime=i,this.remainingTime-=1e3};t(),this.timer=setInterval(t,1e3)}},render(t){return t("span",{class:"countdown"},this.displayTime)}}}},n=o,c=(a("537f"),a("2877")),d=Object(c["a"])(n,s,i,!1,null,"3ff62fe9",null);e["default"]=d.exports},"7ae7":function(t,e,a){"use strict";a("5c36")}}]);
//# sourceMappingURL=chunk-7a5ccde8.488a8887.js.map