(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4dc22284"],{"0daa":function(t,e,s){"use strict";var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"space-between"}},[s("p",{staticStyle:{"font-size":"24px"}},[t._v("猜你想看")]),s("div",{staticStyle:{display:"flex","align-items":"center",gap:"15px"}},[s("el-button",{staticStyle:{"font-size":"14px"},attrs:{type:"text"},on:{click:t.switchBatch}},[s("i",{staticClass:"el-icon-refresh",staticStyle:{"margin-right":"3px"}}),t._v("换一批 ")]),s("el-tooltip",{attrs:{content:null===t.metrics?"数据加载中":"查看推荐效果",placement:"top"}},[s("i",{staticClass:"el-icon-data-analysis",class:{"disabled-icon":null===t.metrics},staticStyle:{cursor:"pointer","font-size":"20px"},on:{click:function(e){null!==t.metrics&&t.showMetrics()}}})])],1)]),t.loading?s("div",{staticStyle:{padding:"20px 0"}},[s("el-skeleton",{attrs:{rows:3,animated:""}}),s("el-skeleton",{staticStyle:{"margin-top":"20px"},attrs:{rows:3,animated:""}})],1):t._l(t.topList,(function(e,o){return s("div",{key:o,staticClass:"gourmet-item",on:{click:function(s){return t.readGourmet(e)}}},[s("div",{staticClass:"left"},[s("el-image",{attrs:{src:e.cover,fit:"cover"}},[s("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[s("i",{staticClass:"el-icon-plus"})])])],1),s("div",{staticClass:"right"},[s("div",{staticClass:"user"},[s("img",{attrs:{src:e.userAvatar,alt:"",srcset:""}}),s("span",[t._v(t._s(e.userName))])]),s("div",{staticClass:"title"},[t._v(t._s(e.title))]),s("div",{staticClass:"info"},[s("span",[t._v(t._s(e.categoryName))]),s("span",[t._v(t._s(t.timeOut(e.createTime)))])])])])})),s("el-dialog",{attrs:{title:"推荐效果统计报告",visible:t.metricsDialogVisible,width:"600px","custom-class":"metrics-dialog","close-on-click-modal":!1,"append-to-body":!0},on:{"update:visible":function(e){t.metricsDialogVisible=e}}},[t.metrics?s("div",{staticClass:"metrics-content"},[s("h3",{staticStyle:{"margin-bottom":"20px",color:"#303133"}},[t._v("当前用户")]),s("div",{staticClass:"metrics-card"},[s("div",{staticClass:"metric-item"},[s("div",{staticClass:"metric-title"},[t._v("准确率")]),s("div",{staticClass:"metric-value"},[t._v(t._s((100*t.metrics.current_user.precision).toFixed(2))+"%")]),s("div",{staticClass:"metric-desc"},[t._v("推荐结果中用户实际喜欢的比例")])]),s("div",{staticClass:"metric-item"},[s("div",{staticClass:"metric-title"},[t._v("召回率")]),s("div",{staticClass:"metric-value"},[t._v(t._s((100*t.metrics.current_user.recall).toFixed(2))+"%")]),s("div",{staticClass:"metric-desc"},[t._v("用户喜欢的内容被推荐的比例")])])]),s("h3",{staticStyle:{margin:"30px 0 20px",color:"#303133"}},[t._v("全局指标")]),s("div",{staticClass:"metrics-card"},[s("div",{staticClass:"metric-item"},[s("div",{staticClass:"metric-title"},[t._v("全局准确率")]),s("div",{staticClass:"metric-value"},[t._v(t._s((100*t.metrics.global_metrics.precision).toFixed(2))+"%")]),s("div",{staticClass:"metric-desc"},[t._v("所有用户的平均准确率")])]),s("div",{staticClass:"metric-item"},[s("div",{staticClass:"metric-title"},[t._v("全局召回率")]),s("div",{staticClass:"metric-value"},[t._v(t._s((100*t.metrics.global_metrics.adjusted_recall).toFixed(2))+"%")]),s("div",{staticClass:"metric-desc"},[t._v("所有用户的平均召回率")])])])]):s("div",{staticClass:"metrics-empty"},[s("el-empty",{attrs:{description:"数据加载中"}})],1)])],2)},i=[],a=s("25a9"),n=s("42ba"),r={name:"RecommendationSystem",data(){return{loading:!0,retryCount:0,maxRetries:3,metricsDialogVisible:!1,metrics:null,topList:[],defaultLoadItem:5,currentBatch:0,allRecommendations:[]}},computed:{displayList(){const t=this.currentBatch*this.defaultLoadItem;return this.allRecommendations.slice(t,t+this.defaultLoadItem)}},methods:{timeOut(t){return Object(a["a"])(t)},loadRecommend(t){const e=localStorage.getItem("token");if(console.log("开始加载推荐数据，用户token:",e?"已登录":"未登录"),!e)return console.warn("用户未登录，无法获取个性化推荐"),this.loading=!1,this.allRecommendations=[],void(this.topList=[]);this.loading=!0;const s=new AbortController,o=setTimeout(()=>s.abort(),3e4);console.log("发送推荐请求到:","/recommend/10"),n["a"].getRecommendationList().then(t=>{clearTimeout(o),console.log("推荐请求响应:",t);const{data:e}=t;200===e.code?(this.handleRecommendData(t.data),this.loadMetrics()):(console.error("推荐请求返回错误:",e.message),this.handleRecommendError(e.message))}).catch(t=>{clearTimeout(o),console.error("推荐请求异常:",t),this.handleRecommendError(t)})},loadMetrics(){const t=new AbortController,e=setTimeout(()=>t.abort(),3e4);n["a"].evaluateMetricsApi().then(t=>{clearTimeout(e),200===t.data.code?this.metrics=t.data.data:this.retryLoadMetrics(1)}).catch(t=>{clearTimeout(e),this.retryLoadMetrics(1)})},retryLoadMetrics(t){t<=3&&(console.log(`第${t}次重试获取统计数据`),setTimeout(()=>{const e=new AbortController,s=setTimeout(()=>e.abort(),3e4);n["a"].evaluateMetricsApi().then(e=>{clearTimeout(s),200===e.data.code?this.metrics=e.data.data:this.retryLoadMetrics(t+1)}).catch(e=>{clearTimeout(s),3===t?(this.$message.error("获取统计数据失败，请稍后重试"),this.metrics=null):this.retryLoadMetrics(t+1)})},1e3*t))},showMetrics(){this.metrics||this.loadMetrics(),this.metricsDialogVisible=!0},handleRecommendData(t){try{if(console.log("推荐系统收到的原始数据:",t),t&&t.data&&t.data.recommended_gourmets)console.log("检测到Python推荐系统数据结构"),this.allRecommendations=t.data.recommended_gourmets,console.log("使用Python推荐系统数据:",this.allRecommendations.length);else if(t&&t.data&&Array.isArray(t.data))console.log("检测到Java后端数据结构"),this.allRecommendations=t.data,console.log("使用Java后端数据:",this.allRecommendations.length);else if(t&&Array.isArray(t))console.log("检测到直接数组数据结构"),this.allRecommendations=t,console.log("使用直接数组数据:",this.allRecommendations.length);else if(t&&"object"===typeof t){console.log("检测到对象数据结构，尝试提取数据");let e=null;for(const s in t){if(Array.isArray(t[s])){e=t[s],console.log(`在键 "${s}" 中找到数组数据`);break}if(t[s]&&"object"===typeof t[s]){for(const o in t[s])if(Array.isArray(t[s][o])){e=t[s][o],console.log(`在键 "${s}.${o}" 中找到数组数据`);break}if(e)break}}e?(this.allRecommendations=e,console.log("使用提取的数组数据:",this.allRecommendations.length)):(console.warn("无法在对象中找到数组数据，设置为空数组"),this.allRecommendations=[])}else console.warn("未识别的数据结构，设置为空数组:",t),this.allRecommendations=[];Array.isArray(this.allRecommendations)||(console.warn("推荐数据不是数组，强制转换为数组"),this.allRecommendations=[]),console.log("最终推荐数据:",this.allRecommendations),this.topList=this.displayList,console.log("显示推荐数据:",this.topList),this.retryCount=0,this.loading=!1}catch(e){console.error("处理推荐数据时出错:",e),this.allRecommendations=[],this.topList=[],this.loading=!1}},switchBatch(){this.currentBatch=0===this.currentBatch?1:0,this.topList=this.displayList},readGourmet(t){console.log("点击美食，准备跳转:",t.id);const e="/gourmetDetail"===this.$route.path&&this.$route.query.id==t.id;e?this.$router.replace({path:"/gourmetDetail",query:{id:t.id,_t:(new Date).getTime()}}).catch(()=>{}):this.$router.push({path:"/gourmetDetail",query:{id:t.id}}).catch(t=>{"NavigationDuplicated"!==t.name&&console.error("路由错误:",t)})},handleRecommendError(t){console.error("推荐系统错误:",t),this.loading=!1,this.retryCount++,this.retryCount<=this.maxRetries?setTimeout(()=>{this.loadRecommend()},1e3*this.retryCount):(this.$message.error("获取推荐数据失败，请稍后重试"),this.allRecommendations=[],this.topList=[])}},mounted(){this.loadRecommend()}},c=r,l=(s("69b6"),s("2877")),d=Object(l["a"])(c,o,i,!1,null,"0a3aae12",null);e["a"]=d.exports},"1a04":function(t,e,s){"use strict";s("db6c")},"25a9":function(t,e,s){"use strict";function o(t){const e=new Date,s=new Date(t),o=(e.getTime()-s.getTime())/1e3;if(o<60)return Math.floor(o)+" 秒前";if(o<3600)return Math.floor(o/60)+" 分钟前";if(o<=86400)return Math.floor(o/3600)+" 小时前";{const t=Math.floor(o/86400);return 1===t?"1 天前":t+" 天前"}}s.d(e,"a",(function(){return o}))},"42ba":function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));var o=s("b775"),i=s("bc3a"),a=s.n(i);const n=a.a.create({baseURL:"http://localhost:5000",timeout:5e3,withCredentials:!0});n.interceptors.request.use(t=>{const e=localStorage.getItem("token");return null!==e&&(t.headers["token"]=e),t},t=>Promise.reject(t)),n.interceptors.response.use(t=>t,t=>(console.warn("Python推荐系统请求错误:",t.message),Promise.reject(t)));const r={getRecommendationList(){return console.log("发送推荐请求到Python系统"),n.get("/recommend/list").then(t=>(console.log("Python推荐系统响应:",t),t)).catch(t=>(console.warn("Python推荐系统请求失败，回退到Java后端:",t),Object(o["a"])({url:"/recommend/10",method:"get",timeout:1e4})))},evaluateMetricsApi(){return console.log("发送评估请求到Python系统"),n.get("/recommend/evaluate").then(t=>(console.log("Python推荐系统评估响应:",t),t)).catch(t=>(console.warn("Python推荐系统评估请求失败，回退到Java后端:",t),Object(o["a"])({url:"/recommend/metrics/evaluate",method:"get",timeout:8e3})))},getTrendingFoods(t=10){return Object(o["a"])({url:"/recommend/trending",method:"get",params:{limit:t}})},getGourmetUV(t){return Object(o["a"])({url:"/recommend/uv/"+t,method:"get"})}}},4582:function(t,e,s){},"692d":function(t,e,s){"use strict";var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{width:"100%"}},[s("el-row",{staticStyle:{margin:"5px 0"}},[s("h2",{staticClass:"commentHeader"},[t._v("评论 "+t._s(t.evaluationsCount))]),s("el-row",{staticStyle:{margin:"15px 0"}},[s("el-col",{attrs:{span:2}},[s("el-avatar",{attrs:{src:t.userData.userAvatar}})],1),s("el-col",{attrs:{span:22}},[s("div",{staticClass:"parent-comment",style:{backgroundColor:t.bgColor,height:t.isFocused?"120px":"70px",borderColor:t.isFocused?"#007bff":"transparent"}},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"comment-parent-input",attrs:{placeholder:"请友好交流"},domProps:{value:t.content},on:{focus:t.onFocus,blur:t.onBlur,input:function(e){e.target.composing||(t.content=e.target.value)}}}),s("div",[s("span",{staticClass:"comment-input-number"},[t._v(t._s(t.content.length)+" / 300")]),s("el-button",{staticClass:"comment-clike",style:{backgroundColor:t.isFocused?"#007bff":"#666",borderColor:t.isFocused?"#007bff":"#666"},attrs:{size:"mini",type:"primary"},on:{click:t.commentClick}},[t._v("评论")])],1)])])],1)],1),s("el-row",{staticStyle:{margin:"5px 0px"}},t._l(t.commentList,(function(e,o){return s("el-row",{key:o,staticStyle:{padding:"10px 0"}},[s("el-row",[s("el-col",{attrs:{span:2}},[s("el-avatar",{attrs:{size:"large",src:e.userAvatar}})],1),s("el-col",{attrs:{span:22}},[s("span",{staticStyle:{height:"40px","line-height":"40px","font-size":"16px",color:"#515767"}},[t._v(t._s(e.userName))]),e.userId==t.userId?s("span",{staticClass:"my-body-tag"},[t._v("我自己")]):t._e()])],1),s("el-row",{staticStyle:{padding:"8px 0"}},[s("el-col",{attrs:{span:22,offset:2}},[s("span",{staticStyle:{"font-size":"16px",color:"#252933"}},[t._v(t._s(e.content))])])],1),s("el-row",{staticStyle:{padding:"8px 0"}},[s("el-col",{attrs:{span:22,offset:2}},[s("span",{staticStyle:{"font-size":"14px",color:"#8A919F"}},[t._v(t._s(e.time))]),e.userId==t.userId?s("el-popconfirm",{attrs:{"confirm-button-text":"好的","cancel-button-text":"不删了",icon:"el-icon-info","icon-color":"red",title:"删除该条评论？"},on:{confirm:function(s){return t.deleteComment(e)}}},[s("span",{staticStyle:{cursor:"pointer","margin-left":"15px","font-size":"14px",color:"#8A919F","user-select":"none"},attrs:{slot:"reference"},slot:"reference"},[s("i",{staticClass:"el-icon-delete"}),t._v(" 删除 ")])]):t._e(),s("span",{staticStyle:{cursor:"pointer","margin-left":"15px","font-size":"14px",color:"#8A919F","user-select":"none"},on:{click:function(s){return t.toggleReplyInput(e)}}},[s("i",{staticClass:"el-icon-chat-dot-round"}),t._v(" 回复"),0!=e.childTotal?s("span",[t._v("("+t._s(e.childTotal)+")")]):t._e()]),s("span",{staticStyle:{cursor:"pointer","margin-left":"15px","font-size":"14px",color:"#8A919F","user-select":"none"},on:{click:function(s){return t.upvote(e)}}},[e.upvoteFlag?s("i",{staticClass:"el-icon-discount",staticStyle:{color:"#1E80FF"}},[t._v(" "+t._s(e.upvoteCount))]):s("i",{staticClass:"el-icon-discount"},[t._v("点赞")])])],1)],1),e.showReplyInput?s("el-row",{staticStyle:{padding:"10px 0"}},[s("el-col",{attrs:{span:22,offset:2}},[s("div",{staticClass:"parent-comment",style:{backgroundColor:t.bgColor,height:"110px",borderColor:"#007bff"}},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.replyContent,expression:"replyContent"}],staticClass:"comment-parent-input",attrs:{placeholder:t.replyText},domProps:{value:t.replyContent},on:{input:function(e){e.target.composing||(t.replyContent=e.target.value)}}}),s("div",[s("span",{staticClass:"comment-input-number"},[t._v(t._s(t.replyContent.length)+" / 300")]),s("el-button",{staticClass:"comment-clike",staticStyle:{"background-color":"#007bff","user-select":"none"},attrs:{size:"mini",type:"primary"},on:{click:function(s){return t.submitReply(e)}}},[t._v("评论")])],1)])])],1):t._e(),t._l(e.commentChildVOS,(function(e,o){return s("el-row",{key:o,staticStyle:{padding:"10px 15px","font-size":"16px"}},[s("el-row",[s("el-col",{attrs:{span:22,offset:2}},[s("el-row",{staticStyle:{display:"flex","align-items":"center","flex-wrap":"wrap"}},[s("el-avatar",{staticStyle:{"margin-right":"5px"},attrs:{size:"small",src:e.userAvatar}}),s("span",{staticStyle:{color:"#515767",padding:"0 5px"}},[t._v(t._s(e.userName))]),e.userId==t.userId?s("span",{staticClass:"my-body-tag"},[t._v("我自己")]):t._e(),null!=e.replierName?s("span",{staticStyle:{margin:"0 15px",color:"#1c1c1c","user-select":"none","font-size":"12px"}},[t._v(" 回复 ")]):t._e(),null!=e.replierName?s("el-avatar",{staticStyle:{"margin-right":"5px"},attrs:{size:"small",src:e.replierAvatar}}):t._e(),null!=e.replierName?s("span",{staticStyle:{color:"#515767",padding:"0 5px"}},[t._v(t._s(e.replierName))]):t._e(),e.replierId==t.userId?s("span",{staticClass:"my-body-tag"},[t._v("我自己")]):t._e(),s("span",{staticStyle:{"letter-spacing":"1px","font-size":"16px",color:"#252933","white-space":"normal","margin-left":"5px",padding:"6px 0"}},[t._v(" : "+t._s(e.content)+" ")])],1),s("el-row",{staticStyle:{padding:"10px 0"}},[s("span",{staticStyle:{"font-size":"14px",color:"#8A919F"}},[t._v(t._s(e.time))]),e.userId==t.userId?s("el-popconfirm",{attrs:{"confirm-button-text":"好的","cancel-button-text":"不删了",icon:"el-icon-info","icon-color":"red",title:"删除该条评论？"},on:{confirm:function(s){return t.deleteComment(e)}}},[s("span",{staticStyle:{cursor:"pointer","margin-left":"15px","font-size":"14px",color:"#8A919F","user-select":"none"},attrs:{slot:"reference"},slot:"reference"},[s("i",{staticClass:"el-icon-delete"}),t._v(" 删除 ")])]):t._e(),s("span",{staticStyle:{cursor:"pointer","margin-left":"15px","font-size":"14px",color:"#8A919F","user-select":"none"},on:{click:function(s){return t.toggleReplyInput1(e)}}},[s("i",{staticClass:"el-icon-chat-dot-round"}),t._v(" 回复 ")]),s("span",{staticStyle:{cursor:"pointer","margin-left":"15px","font-size":"14px",color:"#8A919F","user-select":"none"},on:{click:function(s){return t.upvote(e)}}},[e.upvoteFlag?s("i",{staticClass:"el-icon-discount",staticStyle:{color:"#1E80FF"}},[t._v(" "+t._s(e.upvoteCount))]):s("i",{staticClass:"el-icon-discount"},[t._v("点赞")])])],1),e.replyInputStatus?s("el-row",{staticStyle:{padding:"10px 0"}},[s("el-col",{attrs:{span:24}},[s("div",{staticClass:"parent-comment",style:{backgroundColor:t.bgColor,height:"110px",borderColor:"#007bff"}},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.replyChildContent,expression:"replyChildContent"}],staticClass:"comment-parent-input",attrs:{placeholder:t.replyText},domProps:{value:t.replyChildContent},on:{input:function(e){e.target.composing||(t.replyChildContent=e.target.value)}}}),s("div",[s("span",{staticClass:"comment-input-number"},[t._v(t._s(t.replyChildContent.length)+" / 300")]),s("el-button",{staticClass:"comment-clike",staticStyle:{"background-color":"#007bff"},attrs:{size:"mini",type:"primary"},on:{click:function(s){return t.submitReply1(e)}}},[t._v("评论")])],1)])])],1):t._e()],1)],1)],1)}))],2)})),1),s("el-dialog",{staticStyle:{"user-select":"none","border-radius":"5px"},attrs:{title:"我要举报",visible:t.dialogVisibleReport,width:"30%"},on:{"update:visible":function(e){t.dialogVisibleReport=e}}},[t._l(t.reports,(function(e,o){return s("el-row",{key:o,staticStyle:{"margin-top":"10px"}},[s("el-row",{staticStyle:{"padding-bottom":"10px","user-select":"none"}},[t._v("*"+t._s(e.name))]),s("el-row",t._l(e.list,(function(e,o){return s("span",{key:o,on:{click:function(s){return t.reportItemClick(e)}}},[s("button",{staticClass:"reportItem",style:{border:e.isSelected?"1px solid #4b87bc":"1px solid #f4f4f4"}},[t._v(" "+t._s(e.name)+" ")])])})),0)],1)})),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("button",{staticClass:"cannel-btn",on:{click:function(e){t.dialogVisibleReport=!1}}},[t._v("取消")]),s("button",{staticClass:"yes-btn",on:{click:t.operationReport}},[t._v("确定举报")])])],2)],1)},i=[],a=s("25a9"),n={props:{contentId:{type:Number,default:""},contentType:{type:String,default:""}},data(){return{userData:{},noteData:{},commentContent:"",content:"",commentList:[],replyContent:"",id:null,isFocused:!1,bgColor:"rgb(245 245 245)",strLength:"0/300",replyText:"",userId:"",dialogVisibleReport:!1,reports:[],selectdStatus:!1,evaluationsCount:0,comment:{},replyChildContent:""}},watch:{contentId(t,e){t!==e&&this.loadCommentList()},content(){""!==this.content||(this.isFocused=!1)}},created(){this.getUserInfo(),this.loadCommentList()},methods:{getUserInfo(){const t=sessionStorage.getItem("userInfo");this.userData=JSON.parse(t),this.userId=this.userData.id},upvote(t){let e=t.upvoteList?t.upvoteList.split(","):[];if(e.length)if(t.upvoteFlag){let t=e.indexOf(this.userData.id.toString());-1!==t&&e.splice(t,1)}else e.includes(this.userData.userId.toString())||e.push(this.userData.userId.toString());let s={id:t.id,upvoteList:e.length?e.join(","):this.userData.id};this.$axios.put("evaluations/update",s).then(s=>{200==s.data.code&&(t.upvoteList=e.join(","),t.upvoteFlag=!t.upvoteFlag,t.upvoteCount+=1)}).catch(t=>{console.error("点赞状态设置异常 -> ",t)})},operationReport(){let t=[];this.reports.forEach(e=>{let s=e.list.filter(t=>t.isSelected);0!=s.length&&(t=s)}),t.length?this.$axios.get(`evaluations-reports/report/${this.comment.id}/${t[0].name}`).then(t=>{this.dialogVisibleReport=!1,200==t.data.code?this.$swal.fire({title:"举报操作",text:"举报成功",icon:"success",showConfirmButton:!1,timer:1100}):this.$swal.fire({title:"举报操作",text:t.data.msg,icon:"error",showConfirmButton:!1,timer:1100})}).catch(t=>{console.error("评论举报异常 -> ",t)}):this.$message("请选中举报项")},reportItemClick(t){this.reports.forEach(t=>{t.list.forEach(t=>{t.isSelected=!1})}),t.isSelected=!0},reportList(){this.$axios.get("evaluations/reportList").then(t=>{200==t.data.code&&(this.reports=[],t.data.data.forEach(t=>{let e={name:t.name},s=[];t.list.forEach(t=>{let e={};e.name=t,e.isSelected=!1,s.push(e)}),e.list=s,this.reports.push(e)}))}).catch(t=>{console.error("举报项加载失败 -> ",t)})},reportComment(t){this.reportList(),this.dialogVisibleReport=!0,this.comment=t},deleteComment(t){this.$axios.delete("evaluations/delete/"+t.id).then(t=>{200==t.data.code&&(this.$message.success(t.data.msg),this.loadCommentList())}).catch(t=>{console.error("评论异常 -> ",t)})},onFocus(){this.isFocused=!0},onBlur(){""!==this.content?this.isFocused=!0:this.isFocused=!1},commentClick(){if(""==this.content)return void this.$swal.fire({title:"内容提示",text:"评论内容为空",icon:"success",showConfirmButton:!1,timer:800});const t={contentType:this.contentType,content:this.content,contentId:this.contentId};this.$axios.post("evaluations/insert",t).then(t=>{200==t.data.code?(this.content="",this.$swal.fire({title:"评论操作",text:"评论成功",icon:"success",showConfirmButton:!1,timer:1100}),setTimeout(()=>{this.loadCommentList()},1100)):this.$swal.fire({title:"评论异常",text:t.data.msg,icon:"error",showConfirmButton:!1,timer:1100})}).catch(t=>{console.error("评论异常 -> ",t)})},toggleReplyInput(t){this.replyText=`回复${t.userName}...`,null==t.showReplyInput&&(t.showReplyInput=!1),t.showReplyInput=!t.showReplyInput},toggleReplyInput1(t){null==t.replyInputStatus&&(t.replyInputStatus=!1),t.replyInputStatus=!t.replyInputStatus},submitReply(t){if(""==this.replyContent)return void this.$message("评论内容不能为空");const e={contentType:this.contentType,content:this.replyContent,contentId:this.contentId,parentId:t.id};this.$axios.post("evaluations/insert",e).then(e=>{200==e.data.code?(this.replyContent="",t.showReplyInput=!1,this.$swal.fire({title:"回复操作",text:"回复成功",icon:"success",showConfirmButton:!1,timer:1300}),setTimeout(()=>{this.loadCommentList()},1300)):this.$swal.fire({title:"评论异常",text:e.data.msg,icon:"error",showConfirmButton:!1,timer:1100})}).catch(t=>{console.error("评论异常 -> ",t)})},submitReply1(t){if(""==this.replyChildContent)return void this.$message("评论内容不能为空");const e={replierId:t.userId,contentType:this.contentType,content:this.replyChildContent,contentId:this.contentId,parentId:t.parentId};this.$axios.post("evaluations/insert",e).then(e=>{200==e.data.code?(this.content="",t.replyInputStatus=!1,this.$swal.fire({title:"回复操作",text:"回复成功",icon:"success",showConfirmButton:!1,timer:1300}),setTimeout(()=>{this.loadCommentList()},1300)):this.$swal.fire({title:"评论异常",text:e.data.msg,icon:"error",showConfirmButton:!1,timer:1100})}).catch(t=>{console.error("评论异常 -> ",t)})},goBack(){this.$router.go(-1)},loadCommentList(){this.$axios.get(`evaluations/list/${this.contentId}/${this.contentType}`).then(t=>{200==t.data.code&&(this.commentList=t.data.data.data,this.evaluationsCount=t.data.data.evaluationsCount,this.commentList.forEach(t=>{t.time=Object(a["a"])(t.createTime),t.commentChildVOS.forEach(t=>t.time=Object(a["a"])(t.createTime))}))}).catch(t=>{console.error("评论查询异常异常 -> ",t)})}}},r=n,c=(s("1a04"),s("2877")),l=Object(c["a"])(r,o,i,!1,null,null,null);e["a"]=l.exports},"69b6":function(t,e,s){"use strict";s("ac44")},ac44:function(t,e,s){},bd26:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-row",{staticStyle:{width:"1380px","background-color":"rgb(255,255,255)","border-radius":"2px",margin:"0 auto"}},[s("el-col",{staticStyle:{padding:"10px 20px","border-right":"1px solid rgb(245,245,245)"},attrs:{span:16}},[s("div",{staticStyle:{position:"sticky",top:"65px","z-index":"100","background-color":"rgb(255,255,255)","padding-block":"10px"}},[s("div",{staticClass:"title"},[t._v(t._s(t.gourmet.title))]),s("div",{staticClass:"info"},[s("img",{staticStyle:{width:"20px",height:"20px","border-radius":"10px"},attrs:{src:t.gourmet.userAvatar,alt:""}}),s("span",[t._v(t._s(t.gourmet.userName))]),s("span",[t._v(" "+t._s(t.gourmet.createTime)+" ")]),s("span",[t._v(" 点赞("+t._s(t.gourmet.upvoteCount)+") ")]),s("span",[t._v(" 浏览("+t._s(t.gourmet.viewCount)+") ")]),s("span",[t._v(" 收藏("+t._s(t.gourmet.saveCount)+") ")])])]),s("div",{staticStyle:{"border-top":"1px solid rgb(245,245,245)"}},[s("div",{domProps:{innerHTML:t._s(t.gourmet.content)}})]),s("div",{staticStyle:{margin:"40px 0",display:"flex","justify-content":"center","align-items":"center"}},[s("span",[s("span",{staticClass:"upvote-operation"},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.upvoteStatus?"取消点赞":"点赞这篇帖子",placement:"bottom"}},[s("span",{on:{click:t.opeationUpvote}},[s("i",{staticClass:"el-icon-discount"}),s("span",[t._v(" "+t._s(t.gourmet.upvoteCount)+"人喜欢 ")])])])],1),s("span",{staticClass:"upvote-operation"},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.saveStatus?"取消收藏":"收藏这篇帖子",placement:"bottom"}},[s("span",{on:{click:t.opeationSave}},[s("i",{staticClass:"el-icon-star-off"}),s("span",[t._v(" "+t._s(t.gourmet.saveCount)+"人收藏 ")])])])],1)])]),s("div",{staticStyle:{"border-top":"1px solid rgb(245,245,245)"}},[s("Evaluations",{attrs:{contentId:t.gourmetId,contentType:"GOURMET"}})],1)]),s("el-col",{staticStyle:{padding:"10px 20px",position:"sticky",top:"60px"},attrs:{span:8}},[s("div",{staticStyle:{width:"260px"}},[s("recommendation-system",{on:{"recommend-click":t.readGourmet}})],1),s("div",{staticStyle:{"margin-block":"20px",width:"330px"}},[s("h4",{staticStyle:{"margin-top":"10px"}},[t._v("评分信息")]),t.ratingStatus?t._e():s("div",{staticStyle:{"margin-block":"30px"}},[s("div",{staticStyle:{"margin-block":"4px","font-size":"12px",color:"rgb(4, 81, 165)"}},[t._v("轻触评个分数吧")]),s("el-rate",{attrs:{"show-text":""},on:{change:t.ratingEvent},model:{value:t.ratingScore,callback:function(e){t.ratingScore=e},expression:"ratingScore"}})],1),s("div",{staticStyle:{"border-radius":"5px",padding:"20px",display:"flex","justify-content":"center","align-items":"center","background-color":"rgb(250,250,250)"}},[s("div",[s("div",{staticStyle:{"text-align":"center","margin-block":"5px","font-weight":"bold"}},[t._v("总评分")]),s("el-rate",{attrs:{disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}"},model:{value:t.gourmet.rating,callback:function(e){t.$set(t.gourmet,"rating",e)},expression:"gourmet.rating"}})],1)]),s("div",[0===t.ratingVos.length?s("div",[s("el-empty",{attrs:{description:"暂无评论哦！"}})],1):t._l(t.ratingVos,(function(e,o){return s("div",{key:o,staticStyle:{"margin-block":"10px"}},[s("div",{staticStyle:{display:"flex","justify-content":"left","align-items":"center",gap:"8px"}},[s("img",{staticStyle:{width:"20px",height:"20px","border-radius":"10px"},attrs:{src:e.userAvatar,alt:"",srcset:""}}),s("span",{staticStyle:{"font-size":"12px"}},[t._v(t._s(e.userName))])]),s("div",{staticStyle:{"margin-block":"4px"}},[s("el-rate",{attrs:{disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}"},model:{value:e.score,callback:function(s){t.$set(e,"score",s)},expression:"ratingVO.score"}})],1),s("div",{staticStyle:{"font-size":"12px",color:"rgb(51,51,51)"}},[t._v(" "+t._s(e.createTime)+" ")])])}))],2)])])],1)},i=[],a=s("692d"),n=s("0daa"),r={components:{Evaluations:a["a"],RecommendationSystem:n["a"]},name:"GourmetDetail",data(){return{gourmetId:null,gourmet:{},ratingScore:0,ratingVos:[],upvoteStatus:!1,saveStatus:!1,ratingStatus:!1}},created(){this.loadGourmetId()},methods:{fetchRatingData(t){const e={contentId:t,current:1,size:3};this.$axios.post("/interaction/queryUserRating",e).then(t=>{const{data:e}=t;200===e.code&&(this.ratingVos=e.data)}).catch(t=>{console.log("查询评分信息异常：",t)})},ratingEvent(){this.$axios.post(`/interaction/ratingOperation/${this.gourmetId}/${this.ratingScore}`).then(t=>{const{data:e}=t;200===e.code?(this.gourmet=e.data[0],this.dealRating(this.gourmet),this.$notify({duration:1e3,title:"评分",message:"评分成功",type:"success"}),this.ratingStatus=!0,this.fetchRatingData(this.gourmetId)):this.$message(e.msg)}).catch(t=>{console.log("评分操作异常：",t)})},fetchUpvoteOperation(t){this.$axios.get("/interaction/upvoteStatus/"+t).then(t=>{const{data:e}=t;200===e.code&&(console.log("点赞的状态=>",e.data),this.upvoteStatus=e.data>0)}).catch(t=>{console.log("通过点赞状态异常：",t)})},fetchRatingOperation(t){this.$axios.get("/interaction/ratingStatus/"+t).then(t=>{const{data:e}=t;200===e.code&&(console.log("评分的状态=>",e.data),this.ratingStatus=e.data>0)}).catch(t=>{console.log("通过评分状态异常：",t)})},fetchSaveOperation(t){this.$axios.get("/interaction/saveStatus/"+t).then(t=>{const{data:e}=t;200===e.code&&(console.log("收藏的状态=>",e.data),this.saveStatus=e.data>0)}).catch(t=>{console.log("通过收藏状态异常：",t)})},opeationSave(){this.$axios.post("/interaction/saveOperation/"+this.gourmetId).then(t=>{const{data:e}=t;200===e.code&&(console.log(e.data>0?"收藏成功":"取消收藏成功"),e.data>0?this.gourmet.saveCount+=1:this.gourmet.saveCount-=1,this.saveStatus=e.data>0)}).catch(t=>{console.log("收藏操作异常：",t)})},opeationUpvote(){this.$axios.post("/interaction/upvoteOperation/"+this.gourmetId).then(t=>{const{data:e}=t;200===e.code&&(console.log(e.data>0?"点赞成功":"取消点赞成功"),e.data>0?this.gourmet.upvoteCount+=1:this.gourmet.upvoteCount-=1,this.upvoteStatus=e.data>0)}).catch(t=>{console.log("点赞操作异常：",t)})},readGourmet(t){const e=t.id;this.gourmetId=e,this.fetchGourmetById(e),this.viewOperation(e),this.fetchRatingOperation(e),this.fetchUpvoteOperation(e),this.fetchSaveOperation(e),this.fetchRatingData(e)},loadGourmetId(){this.gourmetId=Number(sessionStorage.getItem("gourmetId")),this.fetchGourmetById(this.gourmetId),this.viewOperation(this.gourmetId),this.fetchUpvoteOperation(this.gourmetId),this.fetchSaveOperation(this.gourmetId),this.fetchRatingOperation(this.gourmetId),this.fetchRatingData(this.gourmetId)},dealRating(t){this.gourmet.rating=null===t.rating?0:t.rating},fetchGourmetById(t){this.$axios.get("/gourmet/"+t).then(t=>{const{data:e}=t;200===e.code&&(this.gourmet=e.data[0],this.dealRating(this.gourmet))}).catch(t=>{console.log("通过ID查询美食做法异常：",t)})},viewOperation(t){this.$axios.post("/interaction/viewOperation/"+t).then(t=>{const{data:e}=t;200===e.code&&console.log("浏览执行...")}).catch(t=>{console.log("浏览操作异常：",t)})}}},c=r,l=(s("ee29"),s("2877")),d=Object(l["a"])(c,o,i,!1,null,"7133771f",null);e["default"]=d.exports},db6c:function(t,e,s){},ee29:function(t,e,s){"use strict";s("4582")}}]);
//# sourceMappingURL=chunk-4dc22284.9d33ff55.js.map