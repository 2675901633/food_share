(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-900ffb70"],{"00ba9":function(t,e,s){"use strict";s("aaaf")},"0daa":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"space-between"}},[s("p",{staticStyle:{"font-size":"24px"}},[t._v("猜你想看")]),s("div",{staticStyle:{display:"flex","align-items":"center",gap:"15px"}},[s("el-button",{staticStyle:{"font-size":"14px"},attrs:{type:"text"},on:{click:t.switchBatch}},[s("i",{staticClass:"el-icon-refresh",staticStyle:{"margin-right":"3px"}}),t._v("换一批 ")]),s("el-tooltip",{attrs:{content:null===t.metrics?"数据加载中":"查看推荐效果",placement:"top"}},[s("i",{staticClass:"el-icon-data-analysis",class:{"disabled-icon":null===t.metrics},staticStyle:{cursor:"pointer","font-size":"20px"},on:{click:function(e){null!==t.metrics&&t.showMetrics()}}})])],1)]),t.loading?s("div",{staticStyle:{padding:"20px 0"}},[s("el-skeleton",{attrs:{rows:3,animated:""}}),s("el-skeleton",{staticStyle:{"margin-top":"20px"},attrs:{rows:3,animated:""}})],1):t._l(t.topList,(function(e,i){return s("div",{key:i,staticClass:"gourmet-item",on:{click:function(s){return t.readGourmet(e)}}},[s("div",{staticClass:"left"},[s("el-image",{attrs:{src:e.cover,fit:"cover"}},[s("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[s("i",{staticClass:"el-icon-plus"})])])],1),s("div",{staticClass:"right"},[s("div",{staticClass:"user"},[s("img",{attrs:{src:e.userAvatar,alt:"",srcset:""}}),s("span",[t._v(t._s(e.userName))])]),s("div",{staticClass:"title"},[t._v(t._s(e.title))]),s("div",{staticClass:"info"},[s("span",[t._v(t._s(e.categoryName))]),s("span",[t._v(t._s(t.timeOut(e.createTime)))])])])])})),s("el-dialog",{attrs:{title:"推荐效果统计报告",visible:t.metricsDialogVisible,width:"600px","custom-class":"metrics-dialog","close-on-click-modal":!1,"append-to-body":!0},on:{"update:visible":function(e){t.metricsDialogVisible=e}}},[t.metrics?s("div",{staticClass:"metrics-content"},[s("h3",{staticStyle:{"margin-bottom":"20px",color:"#303133"}},[t._v("当前用户")]),s("div",{staticClass:"metrics-card"},[s("div",{staticClass:"metric-item"},[s("div",{staticClass:"metric-title"},[t._v("准确率")]),s("div",{staticClass:"metric-value"},[t._v(t._s((100*t.metrics.current_user.precision).toFixed(2))+"%")]),s("div",{staticClass:"metric-desc"},[t._v("推荐结果中用户实际喜欢的比例")])]),s("div",{staticClass:"metric-item"},[s("div",{staticClass:"metric-title"},[t._v("召回率")]),s("div",{staticClass:"metric-value"},[t._v(t._s((100*t.metrics.current_user.recall).toFixed(2))+"%")]),s("div",{staticClass:"metric-desc"},[t._v("用户喜欢的内容被推荐的比例")])])]),s("h3",{staticStyle:{margin:"30px 0 20px",color:"#303133"}},[t._v("全局指标")]),s("div",{staticClass:"metrics-card"},[s("div",{staticClass:"metric-item"},[s("div",{staticClass:"metric-title"},[t._v("全局准确率")]),s("div",{staticClass:"metric-value"},[t._v(t._s((100*t.metrics.global_metrics.precision).toFixed(2))+"%")]),s("div",{staticClass:"metric-desc"},[t._v("所有用户的平均准确率")])]),s("div",{staticClass:"metric-item"},[s("div",{staticClass:"metric-title"},[t._v("全局召回率")]),s("div",{staticClass:"metric-value"},[t._v(t._s((100*t.metrics.global_metrics.adjusted_recall).toFixed(2))+"%")]),s("div",{staticClass:"metric-desc"},[t._v("所有用户的平均召回率")])])])]):s("div",{staticClass:"metrics-empty"},[s("el-empty",{attrs:{description:"数据加载中"}})],1)])],2)},a=[],o=s("25a9"),r=s("42ba"),c={name:"RecommendationSystem",data(){return{loading:!0,retryCount:0,maxRetries:3,metricsDialogVisible:!1,metrics:null,topList:[],defaultLoadItem:5,currentBatch:0,allRecommendations:[]}},computed:{displayList(){const t=this.currentBatch*this.defaultLoadItem;return this.allRecommendations.slice(t,t+this.defaultLoadItem)}},methods:{timeOut(t){return Object(o["a"])(t)},loadRecommend(t){const e=localStorage.getItem("token");if(console.log("开始加载推荐数据，用户token:",e?"已登录":"未登录"),!e)return console.warn("用户未登录，无法获取个性化推荐"),this.loading=!1,this.allRecommendations=[],void(this.topList=[]);this.loading=!0;const s=new AbortController,i=setTimeout(()=>s.abort(),3e4);console.log("发送推荐请求到:","/recommend/10"),r["a"].getRecommendationList().then(t=>{clearTimeout(i),console.log("推荐请求响应:",t);const{data:e}=t;200===e.code?(this.handleRecommendData(t.data),this.loadMetrics()):(console.error("推荐请求返回错误:",e.message),this.handleRecommendError(e.message))}).catch(t=>{clearTimeout(i),console.error("推荐请求异常:",t),this.handleRecommendError(t)})},loadMetrics(){const t=new AbortController,e=setTimeout(()=>t.abort(),3e4);r["a"].evaluateMetricsApi().then(t=>{clearTimeout(e),200===t.data.code?this.metrics=t.data.data:this.retryLoadMetrics(1)}).catch(t=>{clearTimeout(e),this.retryLoadMetrics(1)})},retryLoadMetrics(t){t<=3&&(console.log(`第${t}次重试获取统计数据`),setTimeout(()=>{const e=new AbortController,s=setTimeout(()=>e.abort(),3e4);r["a"].evaluateMetricsApi().then(e=>{clearTimeout(s),200===e.data.code?this.metrics=e.data.data:this.retryLoadMetrics(t+1)}).catch(e=>{clearTimeout(s),3===t?(this.$message.error("获取统计数据失败，请稍后重试"),this.metrics=null):this.retryLoadMetrics(t+1)})},1e3*t))},showMetrics(){this.metrics||this.loadMetrics(),this.metricsDialogVisible=!0},handleRecommendData(t){try{if(console.log("推荐系统收到的原始数据:",t),t&&t.data&&t.data.recommended_gourmets)console.log("检测到Python推荐系统数据结构"),this.allRecommendations=t.data.recommended_gourmets,console.log("使用Python推荐系统数据:",this.allRecommendations.length);else if(t&&t.data&&Array.isArray(t.data))console.log("检测到Java后端数据结构"),this.allRecommendations=t.data,console.log("使用Java后端数据:",this.allRecommendations.length);else if(t&&Array.isArray(t))console.log("检测到直接数组数据结构"),this.allRecommendations=t,console.log("使用直接数组数据:",this.allRecommendations.length);else if(t&&"object"===typeof t){console.log("检测到对象数据结构，尝试提取数据");let e=null;for(const s in t){if(Array.isArray(t[s])){e=t[s],console.log(`在键 "${s}" 中找到数组数据`);break}if(t[s]&&"object"===typeof t[s]){for(const i in t[s])if(Array.isArray(t[s][i])){e=t[s][i],console.log(`在键 "${s}.${i}" 中找到数组数据`);break}if(e)break}}e?(this.allRecommendations=e,console.log("使用提取的数组数据:",this.allRecommendations.length)):(console.warn("无法在对象中找到数组数据，设置为空数组"),this.allRecommendations=[])}else console.warn("未识别的数据结构，设置为空数组:",t),this.allRecommendations=[];Array.isArray(this.allRecommendations)||(console.warn("推荐数据不是数组，强制转换为数组"),this.allRecommendations=[]),console.log("最终推荐数据:",this.allRecommendations),this.topList=this.displayList,console.log("显示推荐数据:",this.topList),this.retryCount=0,this.loading=!1}catch(e){console.error("处理推荐数据时出错:",e),this.allRecommendations=[],this.topList=[],this.loading=!1}},switchBatch(){this.currentBatch=0===this.currentBatch?1:0,this.topList=this.displayList},readGourmet(t){console.log("点击美食，准备跳转:",t.id);const e="/gourmetDetail"===this.$route.path&&this.$route.query.id==t.id;e?this.$router.replace({path:"/gourmetDetail",query:{id:t.id,_t:(new Date).getTime()}}).catch(()=>{}):this.$router.push({path:"/gourmetDetail",query:{id:t.id}}).catch(t=>{"NavigationDuplicated"!==t.name&&console.error("路由错误:",t)})},handleRecommendError(t){console.error("推荐系统错误:",t),this.loading=!1,this.retryCount++,this.retryCount<=this.maxRetries?setTimeout(()=>{this.loadRecommend()},1e3*this.retryCount):(this.$message.error("获取推荐数据失败，请稍后重试"),this.allRecommendations=[],this.topList=[])}},mounted(){this.loadRecommend()}},l=c,n=(s("69b6"),s("2877")),m=Object(n["a"])(l,i,a,!1,null,"0a3aae12",null);e["a"]=m.exports},"25a9":function(t,e,s){"use strict";function i(t){const e=new Date,s=new Date(t),i=(e.getTime()-s.getTime())/1e3;if(i<60)return Math.floor(i)+" 秒前";if(i<3600)return Math.floor(i/60)+" 分钟前";if(i<=86400)return Math.floor(i/3600)+" 小时前";{const t=Math.floor(i/86400);return 1===t?"1 天前":t+" 天前"}}s.d(e,"a",(function(){return i}))},"42ba":function(t,e,s){"use strict";s.d(e,"a",(function(){return c}));var i=s("b775"),a=s("bc3a"),o=s.n(a);const r=o.a.create({baseURL:"http://localhost:5000",timeout:5e3,withCredentials:!0});r.interceptors.request.use(t=>{const e=localStorage.getItem("token");return null!==e&&(t.headers["token"]=e),t},t=>Promise.reject(t)),r.interceptors.response.use(t=>t,t=>(console.warn("Python推荐系统请求错误:",t.message),Promise.reject(t)));const c={getRecommendationList(){return console.log("发送推荐请求到Python系统"),r.get("/recommend/list").then(t=>(console.log("Python推荐系统响应:",t),t)).catch(t=>(console.warn("Python推荐系统请求失败，回退到Java后端:",t),Object(i["a"])({url:"/recommend/10",method:"get",timeout:1e4})))},evaluateMetricsApi(){return console.log("发送评估请求到Python系统"),r.get("/recommend/evaluate").then(t=>(console.log("Python推荐系统评估响应:",t),t)).catch(t=>(console.warn("Python推荐系统评估请求失败，回退到Java后端:",t),Object(i["a"])({url:"/recommend/metrics/evaluate",method:"get",timeout:8e3})))},getTrendingFoods(t=10){return Object(i["a"])({url:"/recommend/trending",method:"get",params:{limit:t}})},getGourmetUV(t){return Object(i["a"])({url:"/recommend/uv/"+t,method:"get"})}}},"69b6":function(t,e,s){"use strict";s("ac44")},aaaf:function(t,e,s){},ac44:function(t,e,s){},fee9:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{"background-color":"rgb(255,255,255)",padding:"20px"}},[s("el-row",[s("el-col",{attrs:{span:18}},[s("div",{staticStyle:{margin:"40px 0"}},[s("span",{staticStyle:{"font-size":"24px",color:"rgb(51,51,51)","font-weight":"bold"}},[t._v("集锦")]),s("el-input",{staticStyle:{width:"266px",float:"right"},attrs:{size:"small",placeholder:"搜索美食",clearable:""},on:{clear:t.handleFilterClear},model:{value:t.gourtmetQueryDto.title,callback:function(e){t.$set(t.gourtmetQueryDto,"title",e)},expression:"gourtmetQueryDto.title"}},[s("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.fetchGourmetData},slot:"append"})],1)],1),s("div",{staticStyle:{"margin-block":"20px"}},t._l(t.categories,(function(e,i){return s("span",{key:i,staticClass:"item-category",style:{backgroundColor:t.categoryClick.id===e.id?"rgb(38, 151, 70)":"",color:t.categoryClick.id===e.id?"rgb(245,245,245)":""},on:{click:function(s){return t.categorySelected(e)}}},[t._v(" "+t._s(e.name)+" ")])})),0),0===t.gourmetList.length?s("div",[s("el-empty",{attrs:{description:"美食做法暂时未找到"}})],1):s("div",[t._l(t.gourmetList,(function(e,i){return s("div",{key:i,staticClass:"item-gourmet",staticStyle:{display:"flex","justify-content":"left"}},[s("div",{staticClass:"left"},[s("img",{attrs:{src:e.cover}})]),s("div",{staticClass:"right"},[s("div",{staticClass:"info"},[s("img",{staticStyle:{width:"20px",height:"20px","border-radius":"10px"},attrs:{src:e.userAvatar,alt:""}}),s("span",[t._v(t._s(e.userName))])]),s("div",{staticClass:"title",staticStyle:{"margin-left":"4px","font-size":"24px"},on:{click:function(s){return t.readGourmet(e)}}},[t._v(" "+t._s(e.title)+" ")]),s("div",{staticClass:"detail"},[t._v(" "+t._s(e.detail)+" ")]),s("div",{staticClass:"detail"},[s("span",[t._v(" "+t._s(e.createTime)+" ")]),s("span",[s("i",{staticClass:"el-icon-discount",staticStyle:{"margin-right":"4px"}}),t._v("("+t._s(e.upvoteCount)+") ")]),s("span",[s("i",{staticClass:"el-icon-view",staticStyle:{"margin-right":"4px"}}),t._v("("+t._s(e.viewCount)+") ")]),s("span",[s("i",{staticClass:"el-icon-star-off",staticStyle:{"margin-right":"4px"}}),t._v("("+t._s(e.saveCount)+") ")])])])])})),s("el-pagination",{staticStyle:{margin:"10px 0"},attrs:{"current-page":t.currentPage,"page-sizes":[10,20],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.totalItems},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],2)]),s("el-col",{staticStyle:{padding:"10px 30px","box-sizing":"border-box",position:"sticky",top:"60px"},attrs:{span:6}},[s("recommendation-system",{on:{"recommend-click":t.readGourmet}})],1)],1)],1)},a=[],o=s("25a9"),r=s("0daa"),c={name:"Gourmet",components:{RecommendationSystem:r["a"]},data(){return{gourtmetQueryDto:{},gourmetList:[],categories:[],filterText:"",currentPage:1,pageSize:10,totalItems:0,categoryClick:{id:null,name:"全部"}}},created(){this.fetchCategoryData(),this.fetchGourmetData()},methods:{timeOut(t){return Object(o["a"])(t)},readGourmet(t){sessionStorage.setItem("gourmetId",t.id),this.$router.push("/gourmetDetail")},handleFilterClear(){this.filterText="",this.fetchGourmetData()},handleSizeChange(t){this.pageSize=t,this.currentPage=1,this.fetchGourmetData()},handleCurrentChange(t){this.currentPage=t,this.fetchGourmetData()},categorySelected(t){this.categoryClick=t,this.gourtmetQueryDto.categoryId=t.id,this.fetchGourmetData()},fetchCategoryData(){this.$axios.post("/category/query",{}).then(t=>{const{data:e}=t;200===e.code&&(this.categories=t.data.data,this.categories.unshift(this.categoryClick))}).catch(t=>{console.log(t)})},fetchGourmetData(){const t={current:this.currentPage,size:this.pageSize,key:this.filterText,...this.gourtmetQueryDto};this.$axios.post("/gourmet/queryList",t).then(t=>{const{data:e}=t;200===e.code&&(this.gourmetList=t.data.data,this.totalItems=e.total)}).catch(t=>{console.log(t)})}}},l=c,n=(s("00ba9"),s("2877")),m=Object(n["a"])(l,i,a,!1,null,"5c9fe420",null);e["default"]=m.exports}}]);
//# sourceMappingURL=chunk-900ffb70.98f09647.js.map