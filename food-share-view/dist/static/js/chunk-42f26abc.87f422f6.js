(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-42f26abc"],{1186:function(e,t,a){},1956:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"default-food-image"},[a("svg",{staticClass:"food-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"}},[a("path",{attrs:{d:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,17H13V14H16V12H13V9H11V12H8V14H11V17Z"}})]),a("span",[e._v("暂无图片")])])},r=[],i={name:"DefaultFoodImage"},l=i,n=(a("7ae7"),a("2877")),o=Object(n["a"])(l,s,r,!1,null,"153742af",null);t["a"]=o.exports},"35ed":function(e,t,a){"use strict";a.d(t,"g",(function(){return r})),a.d(t,"f",(function(){return i})),a.d(t,"d",(function(){return l})),a.d(t,"j",(function(){return n})),a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return c})),a.d(t,"l",(function(){return u})),a.d(t,"c",(function(){return d})),a.d(t,"i",(function(){return m})),a.d(t,"k",(function(){return h})),a.d(t,"e",(function(){return g})),a.d(t,"h",(function(){return f}));var s=a("b775");function r(e){return Object(s["a"])({url:"/flashSale/list",method:"post",data:e})}function i(e){return Object(s["a"])({url:"/flashSale/detail/"+e,method:"get"})}function l(e){return Object(s["a"])({url:"/flashSale/doFlashSale/"+e,method:"post"})}function n(){return Object(s["a"])({url:"/flashSale/myOrders",method:"get"})}function o(e){return Object(s["a"])({url:"/flashSale/cancelOrder/"+e,method:"post"})}function c(e){return Object(s["a"])({url:"/flashSale/admin/create",method:"post",data:e})}function u(e){return Object(s["a"])({url:"/flashSale/admin/update",method:"post",data:e})}function d(e){return Object(s["a"])({url:"/flashSale/admin/delete/"+e,method:"post"})}function m(){return Object(s["a"])({url:"/flashSale/admin/preload",method:"post"})}function h(){return Object(s["a"])({url:"/flashSale/admin/refresh",method:"post"})}function g(e){return Object(s["a"])({url:"/flashSale/orders",method:"post",data:e})}function f(e){return Object(s["a"])({url:"/flashSale/payOrder/"+e,method:"post"})}},"3ba6":function(e,t,a){"use strict";a("1186")},"5c36":function(e,t,a){},"7ae7":function(e,t,a){"use strict";a("5c36")},f625:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flash-sale-manage"},[a("h2",{staticClass:"page-title"},[e._v("秒杀商品管理")]),a("div",{staticClass:"operation-bar"},[a("el-button",{attrs:{type:"primary"},on:{click:e.openAddDialog}},[e._v("添加秒杀商品")]),a("el-button",{attrs:{type:"success"},on:{click:e.handlePreload}},[e._v("预热库存")]),a("el-button",{attrs:{type:"info"},on:{click:e.handleRefresh}},[e._v("刷新状态")]),a("el-button",{on:{click:function(t){return e.$router.push("/flashSaleOrderManage")}}},[e._v("订单管理")])],1),a("div",{staticClass:"search-bar"},[a("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"商品名称",clearable:""},model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}}),a("el-select",{staticClass:"filter-item",attrs:{placeholder:"状态",clearable:""},model:{value:e.searchStatus,callback:function(t){e.searchStatus=t},expression:"searchStatus"}},[a("el-option",{attrs:{label:"未开始",value:0}}),a("el-option",{attrs:{label:"进行中",value:1}}),a("el-option",{attrs:{label:"已结束",value:2}})],1),a("el-date-picker",{staticClass:"filter-item date-picker",attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd HH:mm","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}}),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("搜索")]),a("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.resetSearch}},[e._v("重置")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%"},attrs:{data:e.itemList,border:""}},[a("el-table-column",{attrs:{type:"index",width:"50",align:"center"}}),a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",align:"center"}}),a("el-table-column",{attrs:{prop:"name",label:"商品名称","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover"}},[a("div",[t.row.image?a("img",{staticStyle:{width:"100%"},attrs:{src:t.row.image,alt:"商品图片"}}):a("default-food-image",{staticStyle:{width:"100%",height:"100px"}})],1),a("span",{attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(t.row.name))])])]}}])}),a("el-table-column",{attrs:{label:"价格信息",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("div",{staticClass:"price-info"},[a("span",{staticClass:"label"},[e._v("秒杀价:")]),a("span",{staticClass:"flash-price"},[e._v("¥"+e._s(t.row.flashPrice))])]),a("div",{staticClass:"price-info"},[a("span",{staticClass:"label"},[e._v("原价:")]),a("span",{staticClass:"original-price"},[e._v("¥"+e._s(t.row.originalPrice))])])])]}}])}),a("el-table-column",{attrs:{label:"库存/销量",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(t.row.stock))]),t.row.soldCount?a("div",[e._v("已售: "+e._s(t.row.soldCount))]):a("div",[e._v("未售出")])]}}])}),a("el-table-column",{attrs:{label:"活动时间",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("i",{staticClass:"el-icon-time"}),e._v(" 开始: "+e._s(e.formatDate(t.row.startTime))+" ")]),a("div",[a("i",{staticClass:"el-icon-time"}),e._v(" 结束: "+e._s(e.formatDate(t.row.endTime))+" ")])]}}])}),a("el-table-column",{attrs:{prop:"status",label:"状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:e.getStatusType(t.row.status)}},[e._v(" "+e._s(e.getStatusText(t.row.status))+" ")])]}}])}),a("el-table-column",{attrs:{label:"操作",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary",disabled:1===t.row.status},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{size:"mini",type:"danger",disabled:1===t.row.status},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{"current-page":e.queryParams.current,"page-sizes":[10,20,30,50],"page-size":e.queryParams.size,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1),a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"formRef",attrs:{model:e.formData,rules:e.formRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"商品名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入商品名称"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),a("el-form-item",{attrs:{label:"商品描述",prop:"description"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入商品描述",rows:4},model:{value:e.formData.description,callback:function(t){e.$set(e.formData,"description",t)},expression:"formData.description"}})],1),a("el-form-item",{attrs:{label:"商品图片",prop:"image"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"http://localhost:21090/api/food-share-sys/v1.0/file/upload","show-file-list":!1,"on-success":e.handleImageSuccess,"before-upload":e.beforeImageUpload}},[e.formData.image?a("img",{staticClass:"avatar",attrs:{src:e.formData.image}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),a("div",{staticClass:"image-tip"},[e._v("支持JPG、PNG格式，建议尺寸400x400像素")]),a("el-input",{staticStyle:{"margin-top":"10px"},attrs:{placeholder:"图片URL，可手动输入或通过上方上传"},model:{value:e.formData.image,callback:function(t){e.$set(e.formData,"image",t)},expression:"formData.image"}})],1),a("el-form-item",{attrs:{label:"原价",prop:"originalPrice"}},[a("el-input-number",{attrs:{precision:2,step:.01,min:0},model:{value:e.formData.originalPrice,callback:function(t){e.$set(e.formData,"originalPrice",t)},expression:"formData.originalPrice"}})],1),a("el-form-item",{attrs:{label:"秒杀价",prop:"flashPrice"}},[a("el-input-number",{attrs:{precision:2,step:.01,min:0,max:e.formData.originalPrice},model:{value:e.formData.flashPrice,callback:function(t){e.$set(e.formData,"flashPrice",t)},expression:"formData.flashPrice"}})],1),a("el-form-item",{attrs:{label:"库存",prop:"stock"}},[a("el-input-number",{attrs:{min:1,step:1},model:{value:e.formData.stock,callback:function(t){e.$set(e.formData,"stock",t)},expression:"formData.stock"}})],1),a("el-form-item",{attrs:{label:"活动时间",prop:"timeRange"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy-MM-dd HH:mm","value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"]},model:{value:e.formData.timeRange,callback:function(t){e.$set(e.formData,"timeRange",t)},expression:"formData.timeRange"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:e.submitForm}},[e._v("确定")])],1)],1)],1)},r=[],i=a("35ed"),l=a("1956"),n={name:"FlashSaleManage",components:{DefaultFoodImage:l["a"]},data(){return{queryParams:{name:"",status:null,startTimeBegin:null,startTimeEnd:null,endTimeBegin:null,endTimeEnd:null,current:1,size:10},searchName:"",searchStatus:null,dateRange:[],tableLoading:!1,itemList:[],total:0,dialogVisible:!1,dialogTitle:"添加秒杀商品",submitLoading:!1,formData:{id:null,name:"",description:"",image:"",originalPrice:0,flashPrice:0,stock:1,timeRange:[],startTime:null,endTime:null},formRules:{name:[{required:!0,message:"请输入商品名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入商品描述",trigger:"blur"}],originalPrice:[{required:!0,message:"请输入商品原价",trigger:"blur"}],flashPrice:[{required:!0,message:"请输入秒杀价格",trigger:"blur"}],stock:[{required:!0,message:"请输入商品库存",trigger:"blur"}],timeRange:[{required:!0,message:"请选择活动时间",trigger:"change"}]}}},created(){this.getList()},methods:{getList(){this.tableLoading=!0;const e={...this.queryParams};Object(i["g"])(e).then(e=>{e.data&&200===e.data.code?(this.itemList=e.data.data||[],this.total=e.data.total||this.itemList.length):(this.$message.error(e.data.msg||"获取秒杀商品列表失败"),this.itemList=[],this.total=0)}).catch(e=>{console.error(e),this.$message.error("获取秒杀商品列表失败"),this.itemList=[],this.total=0}).finally(()=>{this.tableLoading=!1})},handleSearch(){this.queryParams.current=1,this.queryParams.name=this.searchName,this.queryParams.status=this.searchStatus,this.dateRange&&2===this.dateRange.length?(this.queryParams.startTimeBegin=this.dateRange[0],this.queryParams.startTimeEnd=this.dateRange[1]):(this.queryParams.startTimeBegin=null,this.queryParams.startTimeEnd=null,this.queryParams.endTimeBegin=null,this.queryParams.endTimeEnd=null),this.getList()},resetSearch(){this.searchName="",this.searchStatus=null,this.dateRange=[],this.queryParams={name:"",status:null,startTimeBegin:null,startTimeEnd:null,endTimeBegin:null,endTimeEnd:null,current:1,size:10},this.getList()},handleCurrentChange(e){this.queryParams.current=e,this.getList()},handleSizeChange(e){this.queryParams.size=e,this.getList()},openAddDialog(){this.dialogTitle="添加秒杀商品",this.formData={id:null,name:"",description:"",image:"",originalPrice:0,flashPrice:0,stock:1,timeRange:[],startTime:null,endTime:null},this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.formRef&&this.$refs.formRef.resetFields()})},handleEdit(e){this.dialogTitle="编辑秒杀商品",this.formData={...e},this.formData.timeRange=[e.startTime,e.endTime],this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.formRef&&this.$refs.formRef.resetFields()})},handleDelete(e){this.$confirm(`确认删除商品"${e.name}"吗？`,"警告",{type:"warning"}).then(()=>{Object(i["c"])(e.id).then(e=>{e.data&&200===e.data.code?(this.$message.success("删除成功"),this.getList()):this.$message.error(e.data.msg||"删除失败")}).catch(e=>{console.error(e),this.$message.error("删除失败")})}).catch(()=>{})},handlePreload(){this.$confirm("确认预热所有秒杀商品库存？这将刷新Redis中的库存数据。","确认",{type:"info"}).then(()=>{Object(i["i"])().then(e=>{e.data&&200===e.data.code?this.$message.success("库存预热成功"):this.$message.error(e.data.msg||"库存预热失败")}).catch(e=>{console.error(e),this.$message.error("库存预热失败")})}).catch(()=>{})},handleRefresh(){this.$confirm("确认刷新所有秒杀商品状态？这将根据当前时间重新计算商品状态。","确认",{type:"info"}).then(()=>{Object(i["k"])().then(e=>{e.data&&200===e.data.code?(this.$message.success("状态刷新成功"),this.getList()):this.$message.error(e.data.msg||"状态刷新失败")}).catch(e=>{console.error(e),this.$message.error("状态刷新失败")})}).catch(()=>{})},submitForm(){this.$refs.formRef.validate(e=>{if(!e)return;this.submitLoading=!0;const t={...this.formData};t.timeRange&&2===t.timeRange.length&&(t.startTime=t.timeRange[0],t.endTime=t.timeRange[1]),delete t.timeRange;const a=t.id?Object(i["l"])(t):Object(i["b"])(t);a.then(e=>{e.data&&200===e.data.code?(this.$message.success(t.id?"更新成功":"添加成功"),this.dialogVisible=!1,this.getList()):this.$message.error(e.data.msg||(t.id?"更新失败":"添加失败"))}).catch(e=>{console.error(e),this.$message.error(t.id?"更新失败":"添加失败")}).finally(()=>{this.submitLoading=!1})})},getStatusText(e){return 0===e?"未开始":1===e?"进行中":2===e?"已结束":"未知"},getStatusType(e){return 0===e?"info":1===e?"success":2===e?"":"warning"},formatDate(e){if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},handleImageSuccess(e,t){e&&200===e.code?(this.formData.image=e.data,this.$message.success("图片上传成功")):this.$message.error("图片上传失败："+(e&&e.msg?e.msg:"未知错误"))},beforeImageUpload(e){const t="image/jpeg"===e.type||"image/png"===e.type,a=e.size/1024/1024<2;return t||this.$message.error("上传图片只能是 JPG 或 PNG 格式!"),a||this.$message.error("上传图片大小不能超过 2MB!"),t&&a}}},o=n,c=(a("3ba6"),a("2877")),u=Object(c["a"])(o,s,r,!1,null,"1a867d5e",null);t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-42f26abc.87f422f6.js.map