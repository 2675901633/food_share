(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cff42bde"],{1956:function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"default-food-image"},[a("svg",{staticClass:"food-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"}},[a("path",{attrs:{d:"M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,17H13V14H16V12H13V9H11V12H8V14H11V17Z"}})]),a("span",[t._v("暂无图片")])])},n=[],r={name:"DefaultFoodImage"},i=r,l=(a("7ae7"),a("2877")),o=Object(l["a"])(i,s,n,!1,null,"153742af",null);e["a"]=o.exports},"35ed":function(t,e,a){"use strict";a.d(e,"g",(function(){return n})),a.d(e,"f",(function(){return r})),a.d(e,"d",(function(){return i})),a.d(e,"j",(function(){return l})),a.d(e,"a",(function(){return o})),a.d(e,"b",(function(){return c})),a.d(e,"l",(function(){return u})),a.d(e,"c",(function(){return d})),a.d(e,"i",(function(){return h})),a.d(e,"k",(function(){return m})),a.d(e,"e",(function(){return f})),a.d(e,"h",(function(){return g}));var s=a("b775");function n(t){return Object(s["a"])({url:"/flashSale/list",method:"post",data:t})}function r(t){return Object(s["a"])({url:"/flashSale/detail/"+t,method:"get"})}function i(t){return Object(s["a"])({url:"/flashSale/doFlashSale/"+t,method:"post"})}function l(){return Object(s["a"])({url:"/flashSale/myOrders",method:"get"})}function o(t){return Object(s["a"])({url:"/flashSale/cancelOrder/"+t,method:"post"})}function c(t){return Object(s["a"])({url:"/flashSale/admin/create",method:"post",data:t})}function u(t){return Object(s["a"])({url:"/flashSale/admin/update",method:"post",data:t})}function d(t){return Object(s["a"])({url:"/flashSale/admin/delete/"+t,method:"post"})}function h(){return Object(s["a"])({url:"/flashSale/admin/preload",method:"post"})}function m(){return Object(s["a"])({url:"/flashSale/admin/refresh",method:"post"})}function f(t){return Object(s["a"])({url:"/flashSale/orders",method:"post",data:t})}function g(t){return Object(s["a"])({url:"/flashSale/payOrder/"+t,method:"post"})}},"4d3c":function(t,e,a){},"5c36":function(t,e,a){},"7ae7":function(t,e,a){"use strict";a("5c36")},d7b9:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"flash-sale-container"},[a("div",{staticClass:"flash-sale-header"},[a("h2",[t._v("限时秒杀")]),a("el-tabs",{on:{"tab-click":t.handleTabClick},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[a("el-tab-pane",{attrs:{label:"进行中",name:"ongoing"}}),a("el-tab-pane",{attrs:{label:"即将开始",name:"upcoming"}}),a("el-tab-pane",{attrs:{label:"已结束",name:"ended"}})],1)],1),a("div",{staticClass:"flash-sale-filter"},[a("el-input",{staticStyle:{width:"220px"},attrs:{placeholder:"搜索商品名称","prefix-icon":"el-icon-search",clearable:""},on:{clear:t.loadData},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.loadData.apply(null,arguments)}},model:{value:t.searchName,callback:function(e){t.searchName=e},expression:"searchName"}}),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.loadData}},[t._v("搜索")]),a("el-button",{attrs:{size:"small"},on:{click:t.resetSearch}},[t._v("重置")]),a("el-button",{attrs:{type:"success",size:"small"},on:{click:function(e){return t.$router.push("/myOrders")}}},[t._v("我的订单")])],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"flash-sale-content"},[0===t.flashSaleItems.length?a("div",{staticClass:"empty-data"},[a("i",{staticClass:"el-icon-goods"}),a("p",[t._v("暂无秒杀商品")])]):a("div",{staticClass:"flash-sale-items"},t._l(t.flashSaleItems,(function(e){return a("el-card",{key:e.id,staticClass:"flash-sale-item",attrs:{"body-style":{padding:"0px"},shadow:"hover"},nativeOn:{click:function(a){return t.goToDetail(e.id)}}},[a("div",{staticClass:"item-image"},[e.image?a("img",{attrs:{src:e.image,alt:"商品图片"}}):a("default-food-image"),a("div",{staticClass:"item-status",class:t.getStatusClass(e.status)},[t._v(" "+t._s(t.getStatusText(e.status))+" ")])],1),a("div",{staticClass:"item-info"},[a("h3",{staticClass:"item-title"},[t._v(t._s(e.name))]),a("div",{staticClass:"item-price"},[a("span",{staticClass:"flash-price"},[t._v("¥"+t._s(e.flashPrice))]),a("span",{staticClass:"original-price"},[t._v("¥"+t._s(e.originalPrice))])]),a("div",{staticClass:"item-progress"},[a("el-progress",{attrs:{percentage:t.getProgressPercentage(e),color:t.getProgressColor(e)}}),a("span",{staticClass:"progress-text"},[t._v("已售 "+t._s(e.soldCount||0)+"/"+t._s(e.stock+(e.soldCount||0)))])],1),a("div",{staticClass:"item-time"},[a("i",{staticClass:"el-icon-time"}),1===e.status?a("countdown",{attrs:{time:1e3*e.remainSeconds,format:"结束: mm分ss秒"}}):0===e.status?a("countdown",{attrs:{time:1e3*e.remainSeconds,format:"开始: mm分ss秒"}}):a("span",[t._v("已结束")])],1)])])})),1),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":t.pageSize,layout:"total, prev, pager, next",total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}})],1)])])},n=[],r=a("35ed"),i=a("1956"),l={name:"FlashSale",components:{DefaultFoodImage:i["a"],countdown:{props:{time:{type:Number,default:0},format:{type:String,default:"mm:ss"}},data(){return{displayTime:"00:00",remainingTime:this.time}},mounted(){this.startCountdown()},beforeDestroy(){this.timer&&clearInterval(this.timer)},methods:{startCountdown(){this.remainingTime=this.time;const t=()=>{if(this.remainingTime<=0)return clearInterval(this.timer),this.$emit("finish"),void setTimeout(()=>{this.$parent.loadData()},1e3);const t=Math.floor(this.remainingTime/1e3%60),e=Math.floor(this.remainingTime/1e3/60%60),a=Math.floor(this.remainingTime/1e3/60/60%24),s=Math.floor(this.remainingTime/1e3/60/60/24);let n=this.format;n=n.replace("dd",s.toString().padStart(2,"0")),n=n.replace("hh",a.toString().padStart(2,"0")),n=n.replace("mm",e.toString().padStart(2,"0")),n=n.replace("ss",t.toString().padStart(2,"0")),this.displayTime=n,this.remainingTime-=1e3};t(),this.timer=setInterval(t,1e3)}},render(t){return t("span",{class:"countdown"},this.displayTime)}}},data(){return{activeTab:"ongoing",searchName:"",loading:!1,flashSaleItems:[],currentPage:1,pageSize:10,total:0,timer:null}},created(){this.loadData(),this.timer=setInterval(this.loadData,3e4)},beforeDestroy(){this.timer&&clearInterval(this.timer)},methods:{loadData(){this.loading=!0;let t=null;"ongoing"===this.activeTab?t=1:"upcoming"===this.activeTab?t=0:"ended"===this.activeTab&&(t=2);const e={name:this.searchName,status:t,current:this.currentPage,size:this.pageSize};Object(r["g"])(e).then(t=>{t.data&&200===t.data.code?(this.flashSaleItems=t.data.data||[],this.total=t.data.total||this.flashSaleItems.length):(this.$message.error(t.data.msg||"获取秒杀商品失败"),this.flashSaleItems=[],this.total=0)}).catch(t=>{console.error(t),this.$message.error("获取秒杀商品失败"),this.flashSaleItems=[],this.total=0}).finally(()=>{this.loading=!1})},handleTabClick(){this.currentPage=1,this.loadData()},handleCurrentChange(){this.loadData()},resetSearch(){this.searchName="",this.currentPage=1,this.loadData()},goToDetail(t){this.$router.push({path:"/flashSaleDetail",query:{id:t}})},getStatusText(t){return 0===t?"未开始":1===t?"进行中":2===t?"已结束":"未知状态"},getStatusClass(t){return 0===t?"upcoming":1===t?"ongoing":2===t?"ended":""},getProgressPercentage(t){if(!t.stock||!t.soldCount)return 0;const e=t.stock+t.soldCount;return Math.floor(t.soldCount/e*100)},getProgressColor(t){const e=this.getProgressPercentage(t);return e<50?"#67c23a":e<80?"#e6a23c":"#f56c6c"}}},o=l,c=(a("d90c"),a("2877")),u=Object(c["a"])(o,s,n,!1,null,"1c87a5ce",null);e["default"]=u.exports},d90c:function(t,e,a){"use strict";a("4d3c")}}]);
//# sourceMappingURL=chunk-cff42bde.8840e098.js.map