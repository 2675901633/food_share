(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c796e"],{"50eb":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticStyle:{"background-color":"#FFFFFF",padding:"5px 0","border-radius":"5px"}},[a("el-row",{staticStyle:{padding:"10px","margin-left":"5px"}},[a("el-row",{staticStyle:{display:"flex","justify-content":"left",gap:"6px"}},[a("span",{staticClass:"edit-button",on:{click:function(e){return t.add()}}},[t._v(" 新增用户 ")]),a("el-select",{staticStyle:{width:"100px"},attrs:{size:"small",placeholder:"登录状态"},on:{change:t.fetchFreshData},model:{value:t.userQueryDto.isLogin,callback:function(e){t.$set(t.userQueryDto,"isLogin",e)},expression:"userQueryDto.isLogin"}},t._l(t.loginStatuList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),a("el-select",{staticStyle:{width:"100px"},attrs:{size:"small",placeholder:"禁言状态"},on:{change:t.fetchFreshData},model:{value:t.userQueryDto.isWord,callback:function(e){t.$set(t.userQueryDto,"isWord",e)},expression:"userQueryDto.isWord"}},t._l(t.wordStatuList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),a("el-select",{staticStyle:{width:"100px"},attrs:{size:"small",placeholder:"用户角色"},on:{change:t.fetchFreshData},model:{value:t.userQueryDto.role,callback:function(e){t.$set(t.userQueryDto,"role",e)},expression:"userQueryDto.role"}},t._l(t.rolesList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),a("el-date-picker",{staticStyle:{width:"216px"},attrs:{size:"small",type:"daterange","range-separator":"至","start-placeholder":"注册开始","end-placeholder":"注册结束"},on:{change:t.fetchFreshData},model:{value:t.searchTime,callback:function(e){t.searchTime=e},expression:"searchTime"}}),a("el-input",{staticStyle:{width:"166px"},attrs:{size:"small",placeholder:"用户名",clearable:""},on:{clear:t.handleFilterClear},model:{value:t.userQueryDto.userName,callback:function(e){t.$set(t.userQueryDto,"userName",e)},expression:"userQueryDto.userName"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.handleFilter},slot:"append"})],1)],1)],1),a("el-row",{staticStyle:{margin:"0 22px","border-top":"1px solid rgb(245,245,245)"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{stripe:!0,data:t.tableData}},[a("el-table-column",{attrs:{prop:"userAvatar",width:"68",label:"头像"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("el-avatar",{staticStyle:{"margin-top":"10px"},attrs:{size:25,src:t.row.userAvatar}})]}}])}),a("el-table-column",{attrs:{prop:"userName",label:"名称"}}),a("el-table-column",{attrs:{prop:"userAccount",width:"128",label:"账号"}}),a("el-table-column",{attrs:{prop:"userEmail",width:"168",label:"邮箱"}}),a("el-table-column",{attrs:{prop:"userRole",width:"68",label:"角色"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(1===e.row.userRole?"管理员":"用户"))])]}}])}),a("el-table-column",{attrs:{prop:"isLogin",width:"108",label:"封号"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isLogin?a("i",{staticClass:"el-icon-warning",staticStyle:{"margin-right":"5px"}}):a("i",{staticClass:"el-icon-success",staticStyle:{"margin-right":"5px",color:"rgb(253, 199, 50)"}}),e.row.isLogin?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"账号一经封号，不可登录系统。经由管理员解禁后，方可登录",placement:"bottom-end"}},[a("span",{staticStyle:{"text-decoration":"underline","text-decoration-style":"dashed"}},[t._v("已封号")])]):a("span",[t._v("正常")])]}}])}),a("el-table-column",{attrs:{prop:"isWord",width:"108",label:"禁言"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isWord?a("i",{staticClass:"el-icon-warning",staticStyle:{"margin-right":"5px"}}):a("i",{staticClass:"el-icon-success",staticStyle:{"margin-right":"5px",color:"rgb(253, 199, 50)"}}),e.row.isWord?a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"账号一经禁言，不可评论互动。经由管理员解禁后，方可评论",placement:"bottom-end"}},[a("span",{staticStyle:{"text-decoration":"underline","text-decoration-style":"dashed"}},[t._v("已禁言")])]):a("span",[t._v("正常")])]}}])}),a("el-table-column",{attrs:{sortable:!0,prop:"createTime",width:"168",label:"注册于"}}),a("el-table-column",{attrs:{label:"操作",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"text-button",on:{click:function(a){return t.handleStatus(e.row)}}},[t._v("账号状态")]),a("span",{staticClass:"text-button",on:{click:function(a){return t.handleEdit(e.row)}}},[t._v("编辑")]),a("span",{staticClass:"text-button",on:{click:function(a){return t.handleDelete(e.row)}}},[t._v("删除")])]}}])})],1),a("el-pagination",{staticStyle:{margin:"10px 0",float:"right"},attrs:{"current-page":t.currentPage,"page-sizes":[20,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.totalItems},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),a("el-dialog",{attrs:{"show-close":!1,visible:t.dialogUserOperaion,width:"25%"},on:{"update:visible":function(e){t.dialogUserOperaion=e}}},[a("div",{staticStyle:{padding:"16px 20px"}},[a("el-row",[a("p",[t._v("用户头像")]),a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"http://localhost:21090/api/food-share-sys/v1.0/file/upload","show-file-list":!1,"on-success":t.handleAvatarSuccess}},[t.userAvatar?a("img",{staticClass:"dialog-avatar",attrs:{src:t.userAvatar}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),a("el-row",[a("span",{staticClass:"dialog-hover"},[t._v("用户名")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.data.userName,expression:"data.userName"}],staticClass:"dialog-input",attrs:{placeholder:"用户名"},domProps:{value:t.data.userName},on:{input:function(e){e.target.composing||t.$set(t.data,"userName",e.target.value)}}}),a("span",{staticClass:"dialog-hover"},[t._v("账号")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.data.userAccount,expression:"data.userAccount"}],staticClass:"dialog-input",attrs:{placeholder:"账号"},domProps:{value:t.data.userAccount},on:{input:function(e){e.target.composing||t.$set(t.data,"userAccount",e.target.value)}}}),a("span",{staticClass:"dialog-hover"},[t._v("邮箱")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.data.userEmail,expression:"data.userEmail"}],staticClass:"dialog-input",attrs:{placeholder:"邮箱"},domProps:{value:t.data.userEmail},on:{input:function(e){e.target.composing||t.$set(t.data,"userEmail",e.target.value)}}}),a("span",{staticClass:"dialog-hover"},[t._v("密码")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.userPwd,expression:"userPwd"}],staticClass:"dialog-input",attrs:{type:"password",placeholder:"密码"},domProps:{value:t.userPwd},on:{input:function(e){e.target.composing||(t.userPwd=e.target.value)}}})])],1),a("span",{staticClass:"dialog-footer",staticStyle:{"margin-top":"10px"},attrs:{slot:"footer"},slot:"footer"},[a("span",{staticClass:"channel-button",on:{click:function(e){return t.cannel()}}},[t._v(" 取消操作 ")]),t.isOperation?a("span",{staticClass:"edit-button",on:{click:function(e){return t.updateOperation()}}},[t._v(" 确定修改 ")]):a("span",{staticClass:"edit-button",on:{click:function(e){return t.addOperation()}}},[t._v(" 确定新增 ")])])]),a("el-dialog",{attrs:{"show-close":!1,visible:t.dialogStatusOperation,width:"18%"},on:{"update:visible":function(e){t.dialogStatusOperation=e}}},[a("div",{staticStyle:{"background-color":"rgba(34, 165, 241)","border-top-left-radius":"5px","border-top-right-radius":"5px"},attrs:{slot:"title"},slot:"title"},[a("p",{staticClass:"dialog-title",staticStyle:{color:"#FFFFFF","font-size":"14px","font-weight":"800"}},[t._v(" 账号状态 ")])]),a("div",{staticStyle:{padding:"10px 20px"}},[a("el-row",[a("p",[t._v("*禁言状态")]),a("el-switch",{attrs:{"inactive-color":"rgb(193, 193, 193)","active-text":"封号","inactive-text":"正常状态"},model:{value:t.data.isLogin,callback:function(e){t.$set(t.data,"isLogin",e)},expression:"data.isLogin"}})],1),a("el-row",{staticStyle:{margin:"20px 0"}},[a("p",[t._v("*禁言状态")]),a("el-switch",{attrs:{"inactive-color":"rgb(193, 193, 193)","active-text":"禁言","inactive-text":"正常状态"},model:{value:t.data.isWord,callback:function(e){t.$set(t.data,"isWord",e)},expression:"data.isWord"}})],1),a("el-row",{staticStyle:{margin:"20px 0"}},[a("p",[t._v("*是否设置为管理员")]),a("el-switch",{attrs:{"inactive-color":"rgb(193, 193, 193)","active-text":"管理员","inactive-text":"普通用户"},model:{value:t.isAdmin,callback:function(e){t.isAdmin=e},expression:"isAdmin"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"customer",staticStyle:{"background-color":"rgb(34, 165, 241)",color:"rgb(247,248,249)",border:"none"},attrs:{size:"small",type:"info"},on:{click:t.comfirmStatus}},[t._v("确认")]),a("el-button",{staticClass:"customer",staticStyle:{"background-color":"rgb(246,246,246)",border:"none"},attrs:{size:"small"},on:{click:t.cannel}},[t._v("取消")])],1)])],1)},i=[],l={data(){return{userPwd:"",userAvatar:"",data:{},filterText:"",isAdmin:!1,currentPage:1,pageSize:20,totalItems:0,dialogStatusOperation:!1,dialogUserOperaion:!1,isOperation:!1,tableData:[],searchTime:[],selectedRows:[],status:null,userQueryDto:{},loginStatuList:[{value:null,label:"全部"},{value:0,label:"正常"},{value:1,label:"封号"}],wordStatuList:[{value:null,label:"全部"},{value:0,label:"正常"},{value:1,label:"禁言"}],rolesList:[{value:null,label:"全部"},{value:2,label:"用户"},{value:1,label:"管理员"}]}},created(){this.fetchFreshData()},methods:{cannel(){this.data={},this.userAvatar="",this.userPwd="",this.dialogUserOperaion=!1,this.dialogStatusOperation=!1,this.isOperation=!1},comfirmStatus(){const t={id:this.data.id,isLogin:this.data.isLogin,userRole:this.isAdmin?1:2,isWord:this.data.isWord};this.$axios.put("/user/backUpdate",t).then(t=>{200===t.data.code&&(this.$notify({duration:1500,title:"信息修改",message:"修改成功",type:"success"}),this.cannel(),this.fetchFreshData())}).catch(t=>{console.log("修改状态异常："+t)})},handleStatus(t){this.isAdmin=1===t.userRole,this.dialogStatusOperation=!0,this.data=t},handleAvatarSuccess(t,e){this.$notify({duration:1500,title:"头像上传",message:200===t.code?"上传成功":"上传失败",type:200===t.code?"success":"error"}),200===t.code&&(this.userAvatar=t.data)},async batchDelete(){if(!this.selectedRows.length)return void this.$message("未选中任何数据");const t=await this.$swalConfirm({title:"删除用户数据",text:"删除后不可恢复，是否继续？",icon:"warning"});if(t)try{let t=this.selectedRows.map(t=>t.id);const e=await this.$axios.post("/user/batchDelete",t);if(200===e.data.code)return this.$notify({duration:1e3,title:"信息删除",message:"删除成功",type:"success"}),void this.fetchFreshData()}catch(e){this.$message.error("用户信息删除异常：",e),console.error("用户信息删除异常：",e)}},async updateOperation(){if(""!==this.userPwd){const t=this.$md5(this.$md5(this.userPwd));this.data.userPwd=t}else this.data.userPwd=null;this.data.userAvatar=this.userAvatar;try{const t=await this.$axios.put("/user/backUpdate",this.data);200===t.data.code&&(this.$notify({duration:1e3,title:"信息修改",message:"修改成功",type:"success"}),this.cannel(),this.fetchFreshData())}catch(t){console.error("修改出错:",t)}},async addOperation(){""!==this.userPwd?this.data.userPwd=this.$md5(this.$md5(this.userPwd)):this.data.userPwd=null,this.data.userAvatar=this.userAvatar;try{const t=await this.$axios.post("/user/insert",this.data);200===t.data.code&&(this.$notify({duration:1e3,title:"信息新增",message:"新增成功",type:"success"}),this.cannel(),this.fetchFreshData())}catch(t){console.error("信息新增出错:",t),this.$message.error("提交失败，请稍后再试！")}},async fetchFreshData(){try{this.tableData=[];let t=null,e=null;if(null!=this.searchTime&&2===this.searchTime.length){const[a,s]=await Promise.all(this.searchTime.map(t=>t.toISOString()));t=a.split("T")[0]+"T00:00:00",e=s.split("T")[0]+"T23:59:59"}const a={current:this.currentPage,size:this.pageSize,key:this.filterText,startTime:t,endTime:e,...this.userQueryDto},s=await this.$axios.post("/user/query",a),{data:i}=s;this.tableData=i.data,this.totalItems=i.total}catch(t){this.$message.error("查询用户信息异常:",t),console.error("查询用户信息异常:",t)}},add(){this.dialogUserOperaion=!0},handleFilter(){this.currentPage=1,this.fetchFreshData()},handleFilterClear(){this.filterText="",this.handleFilter()},handleSizeChange(t){this.pageSize=t,this.currentPage=1,this.fetchFreshData()},handleCurrentChange(t){this.currentPage=t,this.fetchFreshData()},handleEdit(t){this.dialogUserOperaion=!0,this.isOperation=!0,t.userPwd=null,this.userAvatar=t.userAvatar,this.data={...t}},handleDelete(t){this.selectedRows.push(t),this.batchDelete()}}},r=l,o=a("2877"),n=Object(o["a"])(r,s,i,!1,null,"515b3357",null);e["default"]=n.exports}}]);
//# sourceMappingURL=chunk-2d0c796e.93ffb895.js.map